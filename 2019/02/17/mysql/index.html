<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>mysql | MC.KJ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="备份  12mysqldump  -uroot  -p  --all-databases&amp;gt;backup.sqlmysqldump  -uroot  -p  --databases dbname1 dbname2&amp;gt;backup.sql  恢复  1mysql  -uroot  -p  &amp;lt;backup.sql  排查最大连接数  123show global status like">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql">
<meta property="og:url" content="http://yoursite.com/2019/02/17/mysql/index.html">
<meta property="og:site_name" content="MC.KJ">
<meta property="og:description" content="备份  12mysqldump  -uroot  -p  --all-databases&amp;gt;backup.sqlmysqldump  -uroot  -p  --databases dbname1 dbname2&amp;gt;backup.sql  恢复  1mysql  -uroot  -p  &amp;lt;backup.sql  排查最大连接数  123show global status like">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-10-18T06:58:07.286Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mysql">
<meta name="twitter:description" content="备份  12mysqldump  -uroot  -p  --all-databases&amp;gt;backup.sqlmysqldump  -uroot  -p  --databases dbname1 dbname2&amp;gt;backup.sql  恢复  1mysql  -uroot  -p  &amp;lt;backup.sql  排查最大连接数  123show global status like">
  
    <link rel="alternate" href="/atom.xml" title="MC.KJ" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">MC.KJ</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-mysql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/17/mysql/" class="article-date">
  <time datetime="2019-02-17T08:20:34.930Z" itemprop="datePublished">2019-02-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mysql
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>备份</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump  -uroot  -p  --all-databases&gt;backup.sql</span><br><span class="line">mysqldump  -uroot  -p  --databases dbname1 dbname2&gt;backup.sql</span><br></pre></td></tr></table></figure>
<blockquote>
<p>恢复</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql  -uroot  -p  &lt;backup.sql</span><br></pre></td></tr></table></figure>
<blockquote>
<p>排查最大连接数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show global status like &apos;Max_used_connections&apos;; 查询设置的最大连接数</span><br><span class="line">show variables like &apos;%max_connections%&apos;;  查询历史最大连接数</span><br><span class="line">set GLOBAL max_connections=256; 更新最大连接数</span><br></pre></td></tr></table></figure>
<blockquote>
<p>导出mysql结构</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h localhost -uroot -pwise2c2017 -d builderdb &gt; dump.sql</span><br></pre></td></tr></table></figure>
<blockquote>
<p>mysql-用户授权</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &apos;permission&apos;@&apos;%&apos; IDENTIFIED BY &apos;permission&apos;; </span><br><span class="line">#创建用户 % 允许远程用户访问  用户名：permission 密码：permission</span><br><span class="line"></span><br><span class="line">show grants for permission;</span><br><span class="line">#查看permission用户的权限</span><br><span class="line"></span><br><span class="line">grant SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX, REFERENCES  on bldr.* to permission@&apos;%&apos;</span><br><span class="line">#给db中的 bldr数据库实例授权</span><br><span class="line"></span><br><span class="line">grant SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX, REFERENCES  on *.* to permission@&apos;%&apos;</span><br><span class="line">#给全部数据库实例授权</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;permission&apos;@&apos;%&apos;</span><br><span class="line">#授予全部db权限</span><br><span class="line"></span><br><span class="line">revoke  select, insert, update, delete  on *.* from permission@&apos;%&apos;;</span><br><span class="line">#撤销权限</span><br></pre></td></tr></table></figure>
<blockquote>
<p>mysql-问题排查</p>
</blockquote>
<h5 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN select * from test; </span><br><span class="line">#查看sql执行计划</span><br></pre></td></tr></table></figure>
<h5 id="慢日志"><a href="#慢日志" class="headerlink" title="慢日志"></a>慢日志</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 慢日志参数</span><br><span class="line">slow_query_log                  # 是否开启慢查询日志 1:开启 0 关闭</span><br><span class="line">slow-query-log-file             # 慢日志输出的路径</span><br><span class="line">long_query_time                 # 设置慢查询时间阈值 1 表示1秒</span><br><span class="line">log_queries_not_using_indexes   # 查询为使用索引 被记录</span><br><span class="line">log_output                      # 日志存储的方式 默认：FILE  可以是： FILE,TABLE</span><br><span class="line"></span><br><span class="line"># 命令更新参数</span><br><span class="line">set global slow_query_log = 1   </span><br><span class="line">show variables like &apos;%slow_query%&apos;</span><br></pre></td></tr></table></figure>
<h4 id="db权限说明"><a href="#db权限说明" class="headerlink" title="db权限说明"></a>db权限说明</h4><blockquote>
<p>所有库都需要都权限</p>
<ul>
<li>grant SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX, REFERENCES on dbname.* to permission@’%’<br>第三方组件 grafana 权限 （需要DROP权限）</li>
<li>grant SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX, REFERENCES，DROP on dbname.* to permission@’%’<br>autocommit (需要开启)</li>
<li>set global autocommit = 1 </li>
</ul>
</blockquote>
<h4 id="查看mysql-链接数状态"><a href="#查看mysql-链接数状态" class="headerlink" title="查看mysql 链接数状态"></a>查看mysql 链接数状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show processlist</span><br></pre></td></tr></table></figure>
<h4 id="清理mysql-binlog"><a href="#清理mysql-binlog" class="headerlink" title="清理mysql-binlog"></a>清理mysql-binlog</h4><p>当mysql集群开启了主从同步，会产生大量当binlog, 耗费大量的磁盘空间</p>
<p>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 关闭主从</span><br><span class="line">- 设置expire_logs_days 超过过期时间自动清理</span><br><span class="line">- 手动清理日志</span><br></pre></td></tr></table></figure>
<blockquote>
<p>mysql 8 小时超时</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">interactive_timeout  默认8小时超时 8小时不连接自动端口， 用户mysql 客户端</span><br><span class="line">wait_timeout   默认8小时超时 8小时不连接自动断开， 用于类似jdbc 连接</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/17/mysql/" data-id="ck81r056c000g7o9al5t3yhwl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/18/zuul/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          高并发下-Zuul参数调优
        
      </div>
    </a>
  
  
    <a href="/2019/02/17/sonarqube/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">sonarQube+jenkins持续审查</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/02/10/codeReview/">codeReview</a>
          </li>
        
          <li>
            <a href="/2019/11/19/hAvailability/">高可用散记</a>
          </li>
        
          <li>
            <a href="/2019/10/08/nginx/">负载均衡散记</a>
          </li>
        
          <li>
            <a href="/2019/08/30/docker-selenium/">Selenium Grid容器化-分布式测试</a>
          </li>
        
          <li>
            <a href="/2019/02/18/zuul/">高并发下-Zuul参数调优</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 MC.KJ<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>